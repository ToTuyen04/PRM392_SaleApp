<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chat v·ªõi AI</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        .chat-container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .messages { border: 1px solid #ddd; height: 400px; overflow-y: auto; padding: 10px; margin-bottom: 10px; }
        .message { margin: 5px 0; }
        .user { color: #007BFF; }
        .ai { color: green; }
        .support { color: red; font-style: italic; }
        input[type="text"] { width: 80%; padding: 10px; }
        button { width: 18%; padding: 10px; background-color: #007BFF; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
<div class="chat-container">
    <h2>Tr√≤ chuy·ªán v·ªõi AI</h2>
    <div id="messages" class="messages"></div>
    <input type="text" id="messageInput" placeholder="Nh·∫≠p tin nh·∫Øn..."/>
    <button onclick="sendMessage()">G·ª≠i</button>
</div>

<script>
    const userID = 1; // test gi·∫£ l·∫≠p user
    const socket = new SockJS('/ws-chat');
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, () => {
        // Nh·∫≠n ph·∫£n h·ªìi t·ª´ AI ho·∫∑c nh√¢n vi√™n
        stompClient.subscribe(`/topic/messages/${userID}`, (msg) => {
            const data = JSON.parse(msg.body);
            appendMessage(data.message, data.fromAI, data.needHumanSupport);
        });
    });

    function sendMessage() {
        const input = document.getElementById('messageInput');
        const msg = input.value.trim();
        if (!msg) return;

        // Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng
        appendMessage(msg, false, false);

        // G·ª≠i ƒë·∫øn server qua WebSocket
        stompClient.send("/app/chat", {}, JSON.stringify({
            userID: userID,
            message: msg,
            fromAI: false,
            toAdmin: false
        }));

        input.value = '';
    }

    function appendMessage(message, isAI, needHuman) {
        const messages = document.getElementById('messages');
        const div = document.createElement('div');
        div.className = "message " + (isAI ? "ai" : "user");
        div.innerText = (isAI ? "AI: " : "B·∫°n: ") + message;
        messages.appendChild(div);

        if (isAI && needHuman) {
            const notify = document.createElement('div');
            notify.className = "message support";
            notify.innerText = "üîî ƒêang k·∫øt n·ªëi v·ªõi nh√¢n vi√™n h·ªó tr·ª£...";
            messages.appendChild(notify);
        }

        messages.scrollTop = messages.scrollHeight;
    }
</script>
</body>
</html>
